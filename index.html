<a href="#" id="click"> Connect to USB!</a>
<script src="serial.js"></script>

<script>
serial.requestPort = function(){
  const filters = [
    {'vendorId': 0x2341}
  ];
  return navigator.usb.requestDevice({'filters':filters}).then(
    device => new serial.Port(device)
  );
}
var port 
var connectButton = document.getElementById('click')
var textDecoder = new TextDecoder()
connectButton.addEventListener('click', function()
{
  if(port){
    connectButton.textContent = 'Connect'
    port.disconnect()
    port = null
  }
  else {
    serial.requestPort().then(selectedPort => {
      port = selectedPort
      port.connect().then(() => {
        console.log('Connected!')
        connectButton.textContent = 'Disconnect'
        port.onReceive = data => {console.console.log(textDecoder.decode(data))}
        port.onReceiveError = error => {console.log('Receive error: '+ error)}
      }, error => {console.log('Connection error: '+ error) })
    }).catch(error =>{console.log('Connection error: ' + error) })
  }
})
</script>
